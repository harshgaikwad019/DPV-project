<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Admin Panel - Contact Messages</title>
  <style>
    body {font-family: Arial, sans-serif; padding: 20px;}
    table {width:100%; border-collapse:collapse; margin-top:12px}
    th, td {padding:8px; border:1px solid #ddd; text-align:left}
    th {background:#f7f7f7}
    button {padding:6px 10px; border:none; background:#d9534f; color:white; cursor:pointer}
    button:hover {opacity:0.9}
  </style>
</head>
<body>
  <h2>Contact Messages</h2>
  <table>
    <thead>
      <tr><th>Name</th><th>Email</th><th>Message</th><th>Date</th><th>Action</th></tr>
    </thead>
    <tbody id="messagesTable"></tbody>
  </table>

  <script>
    async function loadMessages() {
      try {
        const res = await fetch('/api/contacts');
        const messages = await res.json();
        const t = document.getElementById('messagesTable');
        t.innerHTML = '';
        messages.forEach(m => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${m.name}</td>
            <td>${m.email}</td>
            <td>${m.message}</td>
            <td>${new Date(m.date).toLocaleString()}</td>
            <td><button onclick="deleteMessage('${m._id}')">Delete</button></td>
          `;
          t.appendChild(row);
        });
      } catch (err) {
        console.error(err);
        alert('Failed to load messages');
      }
    }

    async function deleteMessage(id) {
      if (!confirm('Delete this message?')) return;
      try {
        const res = await fetch('/api/contact/' + id, { method: 'DELETE' });
        const data = await res.json();
        if (data.success) loadMessages();
        else alert(data.msg || 'Delete failed');
      } catch (err) {
        console.error(err);
        alert('Network error');
      }
    }

    // initial load
    loadMessages();
  </script>
</body>
</html>
